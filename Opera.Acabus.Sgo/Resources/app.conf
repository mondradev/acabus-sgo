<?xml version="1.0" encoding="utf-8" ?> 
<configuration>
  <Owner name="OPERA" />
  <modules>
    <module assembly="Opera.Acabus.TrunkMonitor.dll" fullname="Opera.Acabus.TrunkMonitor.TrunkMonitorModule" />
    <module assembly="Opera.Acabus.Core.Config.dll" fullname="Opera.Acabus.Core.Config.CoreConfigModule" />
    <module assembly="Opera.Acabus.Cctv.dll" fullname="Opera.Acabus.Cctv.CctvModule" />
  </modules>
  <connectionDb assembly="Libraries/System.Data.SQLite.dll" type="System.Data.SQLite.SQLiteConnection" assemblyDialect="Libraries/Opera.Acabus.DatabaseController.dll" typeDialect="Opera.Acabus.DatabaseController.SQLiteDialect" connectionString="Data Source=Resources/opera.acabus.data.db;Password=acabus*data*dat" />
  <queryCheckReplica>
	<KVR value="select coalesce(sum(pending), 0) pending, min(fch_min) fch_min from ( select 'Tran' des, count(*) pending, min(fch_envi) fch_min from sitm_envi.sbop_tran where bol_envi=false group by des union select 'Tran_Divi' des, count(*) pending, min(fch_envi) fch_min from sitm_envi.sbop_tran_divi where bol_envi=false group by des union select 'Reca' des, count(*) pending, min(fch_envi) fch_min from sitm_envi.sbop_reca where bol_envi=false group by des union select 'Reca_Divi' des, count(*) pending, min(fch_envi) fch_min from sitm_envi.sbop_reca_divi where bol_envi=false group by des ) as pendings" />
	<PMR value="select coalesce(sum(pending), 0) pending, min(fch_min) fch_min from ( select 'Acce_Sali' des, count(*) pending, min(fch_envi) fch_min from sitm_envi.sbop_acce_sali where bol_envi=false group by des union select 'Turn' des, count(*) pending, min(fch_envi) fch_min from sitm_envi.sbop_turn where bol_envi=false group by des ) as pendings" />
	<TD value="select coalesce(sum(pending), 0) pending, min(fch_min) fch_min from ( select 'Acce_Sali' des, count(*) pending, min(fch_envi) fch_min from sitm_envi.sbop_acce_sali where bol_envi=false group by des union select 'Turn' des, count(*) pending, min(fch_envi) fch_min from sitm_envi.sbop_turn where bol_envi=false group by des ) as pendings" />
	<TS value="select coalesce(sum(pending), 0) pending, min(fch_min) fch_min from ( select 'Acce_Sali' des, count(*) pending, min(fch_envi) fch_min from sitm_envi.sbop_acce_sali where bol_envi=false group by des union select 'Turn' des, count(*) pending, min(fch_envi) fch_min from sitm_envi.sbop_turn where bol_envi=false group by des ) as pendings" />
	<TSI value="select coalesce(sum(pending), 0) pending, min(fch_min) fch_min from ( select 'Acce_Sali' des, count(*) pending, min(fch_envi) fch_min from sitm_envi.sbop_acce_sali where bol_envi=false group by des union select 'Turn' des, count(*) pending, min(fch_envi) fch_min from sitm_envi.sbop_turn where bol_envi=false group by des ) as pendings" />
  </queryCheckReplica>
  <serverCC connectionString="User ID=postgres;Password=admin;Host=172.17.0.121;Port=5432;Database=SITM;CommandTimeout=0">
	<downloadFromServer>
		<buses value="select vehi.id_vehi id, vehi.id_tipo_vehi as type, vehi.no_econ economicnumber, coalesce((select id_lin from ( select distinct id_lin_est from ( select id_equi, id_turn, count(*) from sitm.sbop_acce_sali where id_equi in (select id_equi from sitm.sbeq_equi where no_econ=vehi.no_econ) and date(fch_acce_sali) in (select date(max(fch_acce_sali)) from sitm.sbop_acce_sali where id_equi in (select id_equi from sitm.sbeq_equi where no_econ=vehi.no_econ)) group by id_equi, id_turn ) turnos left join sitm.sbop_asgn_turn asgn on turnos.id_equi=asgn.id_equi and turnos.id_turn=asgn.id_turn) asgn left join sitm.sfln_lin_est le on le.id_lin_est=asgn.id_lin_est limit 1),2) idroute from sitm.sfvh_vehi vehi where id_esta=1" />
		<devices value="select id_equi id, nume_seri as serial, dir_ip ip, (select id_est from sitm.sfln_lin_est where id_lin_est=e.id_lin_est) idstation, (select id_vehi from sitm.sfvh_vehi where no_econ=e.no_econ) idbus, (select regexp_matches(nume_seri,'CDE|TSI|TD|TS|KVR|PMR|PCA'))[1] as type from sitm.sbeq_equi e where (select regexp_matches(upper(nume_seri), 'TSI|TD|TS|KVR|PMR|PCA|CDE')) is not null union select cast(substring(nume_seri from 6 for 8) as integer) id, nume_seri as serial, '0.0.0.0' ip, cast(substring(nume_seri from 10 for 2) as integer) idStation, null idBus, 'DSPL' as type from sitm.cctm_inv where (select regexp_matches(upper(nume_seri), 'DS')) is not null order by id" />
		<routes value="select id_lin id, (select regexp_matches(nom, '[0-9]+'))[1] number, substring(nom from position('-' in nom)+1) as name, case when id_tipo_lin=190 then 'TRUNK' when id_tipo_lin=191 then 'ALIM' else 'none' end as type from sitm.sfln_lin where id_esta=1 and id_tipo_lin in (190, 191) order by id_lin asc" />
		<stations value="select e.id_est id, nom_est as name, no_est number, id_lin idroute from sitm.sfes_est e left join sitm.sfln_lin_est le on le.id_est=e.id_est where e.id_esta=1 and tran=154 and e.id_tipo=4 order by number" />
	</downloadFromServer>
  </serverCC>
  <Business>
	  <Business value="OPERA"/>
	  <Business value="GUARDIAS" />
	  <Business value="TRANSPORTISTA" />
	  <Business value="OPD" />
  </Business>
  <RefundOfMoney Money="11" Bill="14" />
</configuration>